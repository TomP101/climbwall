{% extends "base.html" %}
{% block content %}
<h1>Panel administracyjny</h1>

{% set is_edit = route_to_edit is not none %}

<section>
    <h2>
        {% if is_edit %}
            Edytuj drogę: {{ route_to_edit.name }}
        {% else %}
            Dodaj nową drogę
        {% endif %}
    </h2>

    <form id="add-route-form"
          enctype="multipart/form-data"
          method="post"
          action="{% if is_edit %}
                      {{ url_for('update_route', route_id=route_to_edit.id) }}
                  {% else %}
                      {{ url_for('add_route') }}
                  {% endif %}">
        <label>
            Nazwa:
            <input type="text" name="name" required
                   value="{% if is_edit %}{{ route_to_edit.name }}{% endif %}">
        </label>

        <label>
            Wycena:
            <input type="text" name="grade" required
                   value="{% if is_edit %}{{ route_to_edit.grade }}{% endif %}">
        </label>

        <label>
            Typ:
            <select name="type">
                <option value="boulder"
                    {% if is_edit and route_to_edit.type == 'boulder' %}selected{% endif %}>
                    Boulder
                </option>
                <option value="lina"
                    {% if is_edit and route_to_edit.type == 'lina' %}selected{% endif %}>
                    Lina
                </option>
            </select>
        </label>

        <label>
            Sektor:
            <input type="text" name="sector" required
                   value="{% if is_edit %}{{ route_to_edit.sector }}{% endif %}">
        </label>

        <label>
            Opis:
            <textarea name="description">{% if is_edit %}{{ route_to_edit.description }}{% endif %}</textarea>
        </label>

        {% if is_edit and route_to_edit.image_path %}
            <p>Aktualne zdjęcie:</p>
            <img src="{{ route_to_edit.image_path }}"
                 alt="{{ route_to_edit.name }}"
                 style="max-width: 200px; display:block; margin-bottom:10px;">
        {% endif %}

        <label>
            Zdjęcie:
            <input type="file" name="image">
        </label>

        <label>
            Link do wideo:
            <input type="url" name="video_url"
                   value="{% if is_edit %}{{ route_to_edit.video_url }}{% endif %}">
        </label>

        <button type="submit">
            {% if is_edit %}
                Zapisz zmiany
            {% else %}
                Dodaj
            {% endif %}
        </button>

        {% if is_edit %}
            <!-- link powrotu do trybu dodawania -->
            <a href="{{ url_for('admin') }}" style="margin-left:10px;">Anuluj edycję</a>
        {% endif %}
    </form>
</section>

<section>
    <h2>Istniejące drogi</h2>
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Nazwa</th>
            <th>Wycena</th>
            <th>Typ</th>
            <th>Sektor</th>
            <th>Akcje</th>
        </tr>
        </thead>
        <tbody>
        {% for route in routes %}
        <tr>
            <td>{{ route.id }}</td>
            <td>{{ route.name }}</td>
            <td>{{ route.grade }}</td>
            <td>{{ route.type }}</td>
            <td>{{ route.sector }}</td>
            <td>
                <!-- Edycja – GET /admin/edit/<id> -->
                <form method="get" action="{{ url_for('edit_route', route_id=route.id) }}" style="display:inline;">
                    <button type="submit">Edytuj</button>
                </form>

                <!-- Usuwanie – POST /admin/delete/<id> -->
                <form method="post"
                      action="{{ url_for('delete_route', route_id=route.id) }}"
                      style="display:inline;"
                      onsubmit="return confirm('Na pewno usunąć tę drogę?');">
                    <button type="submit">Usuń</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}
