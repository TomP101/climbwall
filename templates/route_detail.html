{% extends "base.html" %}
{% block content %}
<article class="route-detail">
    <header class="route-detail-header">
        <div>
            <h1>{{ route.name }}</h1>

            <div class="route-badges">
                <span class="badge badge-grade">{{ route.grade }}</span>
                <span class="badge badge-type">
                    {% if route.type == 'boulder' %}Boulder{% else %}Lina{% endif %}
                </span>
                <span class="badge badge-sector">{{ route.sector }}</span>
            </div>
        </div>
    </header>

    {% if route.image_path %}
        <img src="{{ route.image_path }}" alt="{{ route.name }}" class="route-detail-image">
    {% endif %}

    <ul class="route-meta">
        <li><strong>Wycena:</strong> {{ route.grade }}</li>
        <li><strong>Typ:</strong> {{ route.type }}</li>
        <li><strong>Sektor:</strong> {{ route.sector }}</li>
        <li><strong>Dodano:</strong> {{ route.created_at.strftime('%Y-%m-%d %H:%M') if route.created_at else '-' }}</li>
    </ul>

    <section>
        <h2>Opis</h2>
        <p>{{ route.description or "Brak opisu." }}</p>
    </section>

    {% if route.video_url %}
    <section>
        <h2>Wideo z przejÅ›cia</h2>
        {% if 'youtube.com' in route.video_url or 'youtu.be' in route.video_url %}
            <div class="video-wrapper">
                <iframe
                    src="{{ route.video_url | replace('watch?v=', 'embed/') }}"
                    frameborder="0"
                    allowfullscreen>
                </iframe>
            </div>
        {% else %}
            <p><a href="{{ route.video_url }}" target="_blank">Zobacz wideo</a></p>
        {% endif %}
    </section>
    {% endif %}

    <section style="margin-top: 18px;">
        <h2>Komentarze</h2>

        {% if current_user_email %}
            <form method="post" action="{{ url_for('add_comment', route_id=route.id) }}">
                <label>
                    Dodaj komentarz:
                    <textarea name="content" required placeholder="Napisz coÅ›..." style="max-width: 900px;"></textarea>
                </label>
                <button type="submit">Dodaj</button>
            </form>
        {% else %}
            <p>
                <a href="{{ url_for('login') }}">Zaloguj siÄ™</a>, aby dodaÄ‡ komentarz.
            </p>
        {% endif %}

        <div style="margin-top: 14px;">
            {% if comments and comments|length > 0 %}
                {% for c in comments %}
                    <div style="padding: 10px 12px; border: 1px solid var(--color-border-subtle); border-radius: 12px; margin-bottom: 10px;">
                        <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
                            <strong>{{ c.user.email }}</strong>
                            <span style="color: var(--color-text-muted); font-size: 0.85rem;">
                                {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}
                            </span>
                        </div>
                        <p style="margin-top: 6px; color: var(--color-text); white-space: pre-wrap;">{{ c.content }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>Brak komentarzy. BÄ…dÅº pierwszy ğŸ™‚</p>
            {% endif %}
        </div>
    </section>


    <p style="margin-top: 18px;">
        <a href="{{ url_for('routes') }}">â† WrÃ³Ä‡ do listy drÃ³g</a>
    </p>
</article>
{% endblock %}
